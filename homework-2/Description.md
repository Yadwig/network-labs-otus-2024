## Домашнее задание 2

### Развертывание коммутируемой сети в резервными каналами

#### Лабораторная среда

В EVE NG cоздана лабораторная с устройствами Cisco IOS в следующей конфигурации:

![net-topology](https://github.com/Yadwig/network-labs-otus-2024/blob/main/homework-2/pictures/net-topology.png?raw=true)

Конфиги устройств перед включением резервных линков выложены в [гитхаб]( https://github.com/Yadwig/network-labs-otus-2024/tree/main/homework-2/config).

#### Проделанная работа

Hostname и ip-адреса присвоены в соответствии с топологией. Назначены пароли для консоли и vty, отключен поиск dns, задано motd. Отключены неиспользуемые интерфейсы. Используемые в задании “физические” интерфейсы переведены в режим транка с нативным vlan 1 и разрешением на все vlan.

Проверка связи через ping (S1-->S2, S1-->S3, S2-->S3) пройдена успешно.

1.  Отключены интерфейсы, образующие “резервные каналы”.
  ![net-topology-2](https://github.com/Yadwig/network-labs-otus-2024/blob/main/homework-2/pictures/turned-off-ints.png?raw=true)

-   Какой коммутатор является корневым мостом? 
*S1.*
-   Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?
*При стандартных приоритетах в 32769 решающим фактором является mac. У S1 он оказался наименьшим – 5000.0001.0000*
![enter image description here](https://github.com/Yadwig/network-labs-otus-2024/blob/main/homework-2/pictures/sh-spanning-tree-1.png?raw=true)

-   Какие порты на коммутаторе являются корневыми портами?
*У S2 это Gi0/3, у S3 – Gi0/1.*
-   Какие порты на коммутаторе являются назначенными портами?  
    *У корневого – оба не выключенные, у S2 – 0/3, у S3 – Gi0/2.*
-   Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?
*У S3 – Gi0/1.*
-   Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?
*Потому что для S3 портом с путем наименьшей стоимости до корневого коммутатора оказался Gi0/2 (непосредственно подключенный к S1, т.е. стоимость 4) К Gi0/1 на S3 подключен S2, у которого также более хороший маршрут до S1 — напрямую, а не через S3 (стоимость была бы 4+4).
Линк блокируется именно на S3 (хотя мог бы и на S2), т.к. у S3 больше BID (а именно mac адрес)*.

2) Изменена стоимость рут порта Gi0/2 у S3.

STP заменяет ранее заблокированный порт на S3 на назначенный порт и блокирует порт на S2, который был назначенным, т.к. стоимость S2->S3->S1 теперь составляет 4+3, а S3->S2->S1 осталась 4+4. Т.е. маршрут до S1 через S3 теперь дешевле.
![changed-cost](https://github.com/Yadwig/network-labs-otus-2024/blob/main/homework-2/pictures/changed-cost.png?raw=true)

3) Убраны изменения стоимости. Включены “резервные порты”.

-   Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста?
*S2 – Gi0/0, S3 – Gi0/2*
-   Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?
*Выбрал по наименьшему id порта отправителя (т.е. S1).*

Вывод команды sh spanning tree на некорневых коммутаторах:
![show-all-ports-stp](https://github.com/Yadwig/network-labs-otus-2024/blob/main/homework-2/pictures/sh-spanning-tree-all-ports-up.png?raw=true)

  #### Вопросы для повторения

 - Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?
*Стоимость пути до корневого моста.*
 - Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?
*BID отправителя.*
 - Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?
*Порт id отправителя.*

